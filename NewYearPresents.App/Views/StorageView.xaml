<UserControl x:Class="NewYearPresents.App.Views.StorageView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NewYearPresents.App.Views"
             xmlns:converters="clr-namespace:NewYearPresents.App.Core.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="800"
             Name="StorageUC"
             Loaded="UserControl_Loaded">
    <UserControl.Resources>
        <converters:MathConverter x:Key="MathConverter"></converters:MathConverter>

        <Style x:Key="DataGridStyle">
            <Setter Property="DataGrid.AutoGenerateColumns" Value="False"/>
            <Setter Property="DataGrid.MinRowHeight" Value="20"/>
            <Setter Property="DataGrid.CanUserAddRows" Value="True"/>
            <Setter Property="DataGrid.VerticalAlignment" Value="Top"/>
            <Setter Property="DataGrid.CanUserReorderColumns" Value="False"/>
            <Setter Property="DataGrid.CanUserResizeColumns" Value="True"/>
            <Setter Property="DataGrid.CanUserSortColumns" Value="True"/>
            <Setter Property="DataGrid.CanUserResizeRows" Value="False"/>
            <!--<Setter Property="DataGrid.SelectionUnit" Value="Cell"/>-->
            <Setter Property="DataGrid.Height" Value="auto"/>
            <Setter Property="DataGrid.MaxHeight" Value="{Binding ElementName=StorageUC,
                    Path=ActualHeight,
                    Converter={StaticResource MathConverter},
                    ConverterParameter=(@VALUE-85)}"/>
            
        </Style>
    </UserControl.Resources>
    <StackPanel>
        <TabControl>
            <TabItem x:Name="ProductTabItem" Header="Продукты"
                     GotFocus="ProductTabItem_GotFocus">
                <TabItem.Content >
                    <DataGrid 
                        Background="White"
                        x:Name="ProductsBoxesDataGrid"
                        Style="{StaticResource DataGridStyle}" 
                        CurrentItem="{Binding DataContext.CurrentObject,
                        RelativeSource={RelativeSource AncestorType=UserControl},
                        Mode=OneWayToSource}"
                        ItemsSource="{Binding ProductsBoxesInStorage}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Width="70"
                Binding="{Binding Path=Id}"
                IsReadOnly="True"
                Foreground="Black">
                                <DataGridTextColumn.Header>
                                    <TextBlock Foreground="Black"
               Text="" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn Width="4*"
                Binding="{Binding Path=ProductsBox.Product.Name}"
                Foreground="Black"
                CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock Foreground="Black"
               Text="Название" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn Width="2*"
                Binding="{Binding Path=ProductsBox.Product.ManufacturerName}"
                Foreground="Black"
                IsReadOnly="True"
                CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock Foreground="Black"
               Text="Производитель" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn Width="2*"
                Binding="{Binding Path=ProductsBox.Product.TypeName}"
                Foreground="Black"
                IsReadOnly="True"
                CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock Foreground="Black"
               Text="Категория" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=ProductsBox.Price30K}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock Foreground="Black"
               Text="Цена (руб)" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=ProductsBox.TotalWeight}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
                    Foreground="Black" Text="Общий вес (кг)" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=ProductsBox.Product.ExpirationDate}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
                    Foreground="Black" Text="Срок годности (мес)" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=Count}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
                    Foreground="Black" Text="Кол-во" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTemplateColumn Width="auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{materialDesign:PackIcon Kind=Garbage}"
                                                BorderBrush="Red"
                                                Command="{Binding DataContext.DeleteButtonCommand,
                                            RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                Background="#FFA20000"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>

                        <DataGrid.ContextMenu>
                            <ContextMenu>
                                <MenuItem Header="Add New Row" 
              Command="{Binding AddNewPersonCommand}"/>
                            </ContextMenu>
                        </DataGrid.ContextMenu>
                    </DataGrid>
                </TabItem.Content>
            </TabItem>
            <TabItem x:Name="PackagingTabItem" Header="Упаковки"
                     GotFocus="PackagingTabItem_GotFocus">
                <TabItem.Content>
                    <DataGrid 
                        Background="White" x:Name="PackagingsDataGrid"
                        Style="{StaticResource DataGridStyle}"
                        CurrentItem="{Binding DataContext.CurrentObject, 
                        RelativeSource={RelativeSource AncestorType=UserControl}, 
                        Mode=OneWayToSource}"
                        ItemsSource="{Binding PackagingsInStorage}">
                        <DataGrid.Columns>
                            <DataGridTextColumn Width="70"
                                Binding="{Binding Path=Id}"
                                IsReadOnly="True"
                                Foreground="Black">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
                    Foreground="Black" Text="" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="4*" Binding="{Binding Path=Packaging.Name}"
            Foreground="Black" CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
                    Foreground="Black" Text="Название" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=Packaging.MaxWeight}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
        Foreground="Black" Text="Макс. вес (кг)" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTextColumn 
            Width="*" Binding="{Binding Path=Count}"
            Foreground="Black" IsReadOnly="True"
            CanUserSort="True">
                                <DataGridTextColumn.Header>
                                    <TextBlock 
        Foreground="Black" Text="Кол-во" />
                                </DataGridTextColumn.Header>
                            </DataGridTextColumn>

                            <DataGridTemplateColumn Width="auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{materialDesign:PackIcon Kind=Garbage}"
                    BorderBrush="Red"
                    Command="{Binding DataContext.DeleteButtonCommand,
                RelativeSource={RelativeSource AncestorType=UserControl}}"
                    Background="#FFA20000"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                </TabItem.Content>
            </TabItem>
        </TabControl>

        <Button 
            Background="White" Foreground="Black"
            BorderBrush="Black" Content="Добавить"
            Width="auto" Command="{Binding Path=AddingInStorage}"
            Margin="0 5 0 0"/>
    </StackPanel>
</UserControl>
